# network interface settings; autogenerated
# Please do NOT modify this file directly, unless you know what
# you're doing.
#
# If you want to manage parts of the network configuration manually,
# please utilize the 'source' or 'source-directory' directives to do
# so.
# PVE will preserve these directives, but will NOT read its network
# configuration from sourced files, so do not attempt to move any of
# the PVE managed interfaces into external files!

# You'll want to update anything wrapped in <>. Use `ifreload -a` NOT systemctl to restart your networking.
# Replace any instance of eth0 with your respective network interface.

auto lo
iface lo inet loopback

auto eth0
iface eth0 inet static
        address <mainCIDR>
        gateway <mainGateway>

iface eth0 inet6 static
        address <mainV6CIDR>
        gateway <mainV6Gateway>

auto vmbr0
iface vmbr0 inet static
        address <mainCIDR>
        bridge-ports none
        bridge-stp off
        bridge-fd 0
        # Add an additional post-up for each public facing ipv4
        #post-up ip route add <additionalIP>/32 dev vmbr0
#Public

auto vmbr1
iface vmbr1 inet static
        address 192.168.1.1/24
        bridge-ports none
        bridge-stp off
        bridge-fd 0
        post-up   iptables -t nat -A POSTROUTING -s '192.168.1.0/24' -o eth0 -j MASQUERADE
        post-down iptables -t nat -D POSTROUTING -s '192.168.1.0/24' -o eth0 -j MASQUERADE
        post-up   iptables -t raw -I PREROUTING -i fwbr+ -j CT --zone 1
        post-down iptables -t raw -D PREROUTING -i fwbr+ -j CT --zone 1
#Nat
